<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>crazyeights225</title>
   
    <link rel="stylesheet" href="../assets/bulma.min.css">
    <link rel="stylesheet" href="../static/default.min.css"><script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.4.0/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script><script src="../assets/js/navbar.js"></script><style>
      span{margin: 0; line-height: 125%; white-space:pre-wrap;white-space:-moz-pre-wrap;white-space:-pre-wrap;white-space:-o-pre-wrap;word-wrap:break-word;}pre{padding:0.5rem 0.5rem!important;}
    </style>
  </head>
  <body>
    <div id="app" class="mt-2">
        <nav class="navbar container" role="navigation" aria-label="main navigation">
            <div class="navbar-brand">
              <a class="navbar-item" href="/">
                <img src="../assets/logo.png">
              </a>
              <a role="button" class="navbar-burger burger" aria-label="menu" aria-expanded="false" data-target="navbar">
                <span aria-hidden="true"></span>
                <span aria-hidden="true"></span>
                <span aria-hidden="true"></span>
              </a>
            </div>
            <div id="navbar" class="navbar-menu">
              <div class="navbar-start">
                    <a href="../index.html" class="navbar-item">Posts</a>
                    <a href="../projects.html" class="navbar-item">Projects</a>
              </div>
            </div>
          </nav>
    </div>
    <div class="hero-body mt-2" style="background-color: #285aff;">
        <div class="container has-text-centered">
            <h1 class="title" style="color: #f1f1f1;">
                HackTheBox: Active
            </h1>
            <h2 class="subtitle" style="color: #f1f1f1;">
                Jan, 2021
            </h2>
        </div>
    </div>
<section class="section mt-2">
  <div class="container">
  <div class="columns">
  <div class="content column is-10">
    <nav class="breadcrumb mb-5" aria-label="breadcrumbs">
        <ul>
          <li><a href="../index.html">Posts</a></li>
          <li><a href="../sec.html">CTFs and Vulnerable VMs</a></li>
          <li class="is-active"><a href="#" aria-current="page">Active</a></li>
        </ul>
      </nav>
<p>Note: I am working on explaining my steps more. I don&#x27;t know how good I am at doing that.</p><p>I found this really easy, because I did half of it earlier (Jan 20) , but couldn&#x27;t finish it because all my requests kept timing out because HackTheBox was undergoing maintenance (I think), so I felt like I knew exactly what to do. </p><p>This would be a good box for beginners to learn about Active Directories. It could probably be rated easy not medium.</p><h2>Scanning:</h2><p>Finding open ports and running services:</p><figure id="46ba46c8-ab81-4083-9692-d951937477f7" class="image"><a href="Active%2046ba46c8ab8140839692d951937477f7/Screenshot_from_2021-01-22_20-15-03.png"><img style="width:714px" src="Active%2046ba46c8ab8140839692d951937477f7/Screenshot_from_2021-01-22_20-15-03.png"/></a></figure><p>Starting by checking for null shares</p><h2>SMB</h2><p>Using smbmap we can list shares, and what permissions we have for them.</p><p>We can see that we have read access to the Replication share:</p><figure id="05696adf-4109-4339-b23e-525bcdb808d2" class="image"><a href="Active%2046ba46c8ab8140839692d951937477f7/Screenshot_from_2021-01-22_20-15-41.png"><img style="width:926px" src="Active%2046ba46c8ab8140839692d951937477f7/Screenshot_from_2021-01-22_20-15-41.png"/></a></figure><p>
</p><p>Use smbclient to access the Replication share:</p><figure id="5881de06-6aaa-4943-a983-00979a15d3a3" class="image"><a href="Active%2046ba46c8ab8140839692d951937477f7/Screenshot_from_2021-01-22_20-16-33.png"><img style="width:986px" src="Active%2046ba46c8ab8140839692d951937477f7/Screenshot_from_2021-01-22_20-16-33.png"/></a></figure><p>The folder active.htb suggests the domain is active.htb, so for efficiency we can add the following line to /etc/hosts:</p><pre id="e7722a51-0bd9-49d7-bf07-bb107281bccb" class="code code-wrap"><code><span>10.10.10.100	active.htb</span></code></pre><p>
</p><p>Check each directory for information, download all files that might be helpful:</p><figure id="9672a789-d71e-4325-8ef9-ffa11ec45eec" class="image"><a href="Active%2046ba46c8ab8140839692d951937477f7/Screenshot_from_2021-01-22_20-18-25.png"><img style="width:986px" src="Active%2046ba46c8ab8140839692d951937477f7/Screenshot_from_2021-01-22_20-18-25.png"/></a></figure><p>We find file Groups.xml in the folder</p><pre id="5a72aed1-a454-4fd7-887e-2e602e2fa1b5" class="code code-wrap"><code><span>active.htb\Policies\{31B2F340-016D-11D2-945F-00C04FB984F9}\MACHINE\Preferences\Groups\Groups.xml</span></code></pre><p>
</p><p>This file contains the following:</p><figure id="2056dc7a-b341-4973-9769-eb18d9ae4cc4" class="image"><a href="Active%2046ba46c8ab8140839692d951937477f7/Screenshot_from_2021-01-22_20-18-48.png"><img style="width:991px" src="Active%2046ba46c8ab8140839692d951937477f7/Screenshot_from_2021-01-22_20-18-48.png"/></a></figure><p>The group policy file contains credentials:</p><pre id="29208e53-4242-447c-86e9-4eba4c754312" class="code code-wrap"><code>Group Policies for account management are stored on the Domain Controller in “Groups.xml” files buried in the SYSVOL folder.</code></pre><p>The tool gpp-decrypt was found to decrypt the cpassword in Groups.xml file.</p><p><a href="https://github.com/t0thkr1s/gpp-decrypt">https://github.com/t0thkr1s/gpp-decrypt</a></p><p>
</p><p>Run the tool to retrieve the credentials from groups file:</p><pre id="34fe743c-aa76-4306-a5de-e3e4455ca029" class="code code-wrap"><code><span>python3 gpp-decrypt.py -f /home/crazyeights/Groups.xml</span></code></pre><p>
</p><figure id="26e3b359-3b03-44f1-a05a-7f8fb6cabe59" class="image"><a href="Active%2046ba46c8ab8140839692d951937477f7/Screenshot_from_2021-01-22_20-20-20.png"><img style="width:656px" src="Active%2046ba46c8ab8140839692d951937477f7/Screenshot_from_2021-01-22_20-20-20.png"/></a></figure><p>
</p><p>With these credentials we can check for further available shares:</p><figure id="cb74eb53-5880-406f-bd2e-99ef44a174cc" class="image"><a href="Active%2046ba46c8ab8140839692d951937477f7/Screenshot_from_2021-01-22_20-21-40.png"><img style="width:966px" src="Active%2046ba46c8ab8140839692d951937477f7/Screenshot_from_2021-01-22_20-21-40.png"/></a></figure><p>We now have access to NETLOGON, Replication, SYSVOL, and Users.</p><p>The Users share sounds promising.</p><p>Use smbclient to access the share Users.</p><figure id="5c8ff103-5571-4f51-b68f-9684069fe8bd" class="image"><a href="Active%2046ba46c8ab8140839692d951937477f7/Screenshot_from_2021-01-22_20-23-36.png"><img style="width:986px" src="Active%2046ba46c8ab8140839692d951937477f7/Screenshot_from_2021-01-22_20-23-36.png"/></a></figure><p>We can find the user flag in the folder SVC_TGS\Desktop:</p><figure id="38b76677-dad3-40c4-9bf2-b3a42093f964" class="image"><a href="Active%2046ba46c8ab8140839692d951937477f7/Screenshot_from_2021-01-22_20-24-12.png"><img style="width:986px" src="Active%2046ba46c8ab8140839692d951937477f7/Screenshot_from_2021-01-22_20-24-12.png"/></a></figure><p>We know have user.txt:</p><figure id="087a6cae-741b-491a-82ae-3a3ba1d32b9e" class="image"><a href="Active%2046ba46c8ab8140839692d951937477f7/Screenshot_from_2021-01-22_22-16-09.png"><img style="width:714px" src="Active%2046ba46c8ab8140839692d951937477f7/Screenshot_from_2021-01-22_22-16-09.png"/></a></figure><p>
</p><p>Use rpcclient to enumerate domain users, and groups:</p><figure id="c8723db6-2f2c-43b1-bec7-3833205fcec0" class="image"><a href="Active%2046ba46c8ab8140839692d951937477f7/Screenshot_from_2021-01-22_20-31-29.png"><img style="width:712px" src="Active%2046ba46c8ab8140839692d951937477f7/Screenshot_from_2021-01-22_20-31-29.png"/></a></figure><p>
</p><p>The next step is to get the Administrator&#x27;s password.</p><p>We can use the impacket script GetUserSPN.py which gets service principal names that are associated with a normal user account. </p><ul id="65320935-a4e5-4f53-981e-7429f9fdd3d9" class="bulleted-list"><li>If we can get a valid TGS for SPNs, then a TGS request encrypts the ticket with the account that the SPN is running under, which allows for bruteforcing of SPNs account NTLM hash</li></ul><p>
</p><pre id="28990f06-fe36-43ef-9d1c-9c174f160752" class="code code-wrap"><code><span>python GetUserSPNs.py -dc-ip 10.10.10.100 active.htb/SVC_TGS -request</span></code></pre><figure id="fbffd2cf-05c5-4336-98cf-6e6fd2a1fccd" class="image"><a href="Active%2046ba46c8ab8140839692d951937477f7/Screenshot_from_2021-01-22_20-39-38.png"><img style="width:1378px" src="Active%2046ba46c8ab8140839692d951937477f7/Screenshot_from_2021-01-22_20-39-38.png"/></a></figure><p>We can copy and paste the Administrator hash to a text file and then use john to crack it.</p><figure id="7dd44d65-656a-4246-9719-1b17a3d11a26" class="image"><a href="Active%2046ba46c8ab8140839692d951937477f7/Screenshot_from_2021-01-22_20-40-32.png"><img style="width:657px" src="Active%2046ba46c8ab8140839692d951937477f7/Screenshot_from_2021-01-22_20-40-32.png"/></a></figure><p>
</p><p>Now we have the credentials for the domain Administrator. </p><p>We can now check which shares the Administrator can access</p><p>Using smbmap to list shares and permissions:</p><figure id="38cb1162-348c-40c6-b16b-d0b0baace2bb" class="image"><a href="Active%2046ba46c8ab8140839692d951937477f7/Screenshot_from_2021-01-22_20-41-24.png"><img style="width:877px" src="Active%2046ba46c8ab8140839692d951937477f7/Screenshot_from_2021-01-22_20-41-24.png"/></a></figure><p>
</p><p>Lets check the share C$:</p><figure id="67d0e310-6027-42a7-92fc-4d42abc20b27" class="image"><a href="Active%2046ba46c8ab8140839692d951937477f7/Screenshot_from_2021-01-22_20-43-02.png"><img style="width:637px" src="Active%2046ba46c8ab8140839692d951937477f7/Screenshot_from_2021-01-22_20-43-02.png"/></a></figure><p>
</p><p>We now have access to the C drive. We can retrieve the root hash:</p><figure id="e4700227-fe63-4964-aca6-501a3a3a3c0d" class="image"><a href="Active%2046ba46c8ab8140839692d951937477f7/Screenshot_from_2021-01-22_20-43-25.png"><img style="width:653px" src="Active%2046ba46c8ab8140839692d951937477f7/Screenshot_from_2021-01-22_20-43-25.png"/></a></figure><p>
</p><p>We now have root.txt:</p><figure id="62085f9e-b58a-4f6c-8ac0-40791dbcea25" class="image"><a href="Active%2046ba46c8ab8140839692d951937477f7/Screenshot_from_2021-01-22_22-16-22.png"><img style="width:714px" src="Active%2046ba46c8ab8140839692d951937477f7/Screenshot_from_2021-01-22_22-16-22.png"/></a></figure><h3>To Get a Root Shell:</h3><p>Use impacket script psexec, since the shared path is writeable we can use psexec to execute commands on the server:</p><pre id="e32ec296-8add-492c-8a31-bd2ef8f869f3" class="code code-wrap"><code><span>python psexec.py active.htb/Administrator:Ticketmaster1968@10.10.10.100</span></code></pre><figure id="0976044d-6232-4d2c-ad02-258dc744fe56" class="image"><a href="Active%2046ba46c8ab8140839692d951937477f7/Screenshot_from_2021-01-22_20-52-18.png"><img style="width:714px" src="Active%2046ba46c8ab8140839692d951937477f7/Screenshot_from_2021-01-22_20-52-18.png"/></a></figure><p>FIN. 🥳</p>
</div>
</div></div></section><footer class="footer">
    <div class="container">
        <div class="columns">
        </div>
    </div>
</footer>
</body>
</html>