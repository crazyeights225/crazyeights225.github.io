<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>crazyeights225</title>
   
    <link rel="stylesheet" href="../assets/bulma.min.css">
    <link rel="stylesheet" href="../static/default.min.css"><script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.4.0/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script>
    <style>
      span{margin: 0; line-height: 125%; white-space:pre-wrap;white-space:-moz-pre-wrap;white-space:-pre-wrap;white-space:-o-pre-wrap;word-wrap:break-word;}pre{padding:0.5rem 0.5rem!important;}
    </style>
  </head>
  <body>
    <div id="app" class="mt-2">
        <nav class="navbar container" role="navigation" aria-label="main navigation">
            <div class="navbar-brand">
              <a class="navbar-item" href="/">
                <img src="../assets/logo.png">
              </a>
              <a role="button" class="navbar-burger burger" aria-label="menu" aria-expanded="false" data-target="navbarBasicExample">
                <span aria-hidden="true"></span>
                <span aria-hidden="true"></span>
                <span aria-hidden="true"></span>
              </a>
            </div>
            <div id="navbar" class="navbar-menu">
              <div class="navbar-start">
                    <a href="../index.html" class="navbar-item">Posts</a>
                    <a href="../projects.html" class="navbar-item">Projects</a>
              </div>
            </div>
          </nav>
    </div>
    <div class="hero-body mt-2" style="background-color: #285aff;">
        <div class="container has-text-centered">
            <h1 class="title" style="color: #f1f1f1;">
                findthebad: model-3
            </h1>
            <h2 class="subtitle" style="color: #f1f1f1;">
                Oct, 2020
            </h2>
        </div>
    </div>
</section>
<section class="container mt-2">
<div class="content column is-10">
    <nav class="breadcrumb mb-5" aria-label="breadcrumbs">
        <ul>
          <li><a href="../index.html">Posts</a></li>
          <li><a href="../sec.html">CTFs and Vulnerable VMs</a></li>
          <li class="is-active"><a href="#" aria-current="page">findthebad: model-3</a></li>
        </ul>
      </nav>
<ul>
<li>log analysis/blue team focused lab</li>
<li>introductory lab for doing log analysis with Kibana</li>
</ul>
<h5>Link:</h5>
<p><a href="https://github.com/findthebad/model-3">https://github.com/findthebad/model-3</a></p>
<h3>Prereqs:</h3>
<pre><code><span>sudo apt-get install docker
sudo apt-get install docker-compose
</span></code></pre>
<h3>Setup:</h3>
<pre><code><span>git clone https://github.com/findthebad/model-3
cd model-3/
docker-compose up
</span></code></pre>
<ul>
<li>Go to localhost:5601 to access the Kibana instance.</li>
</ul>
<h4>Lab questions:</h4>
<ul>
<li>What is the name of the malicious file that has executed?</li>
<li>What strain of malware does it appear to be?</li>
<li>What does this malware typically do?</li>
<li>When was this malware run and by which user on what computer? (Hint: Try pinning a Dashboard filter and viewing it in Discover)</li>
<li>What process wrote the malicious file to disk and when?</li>
</ul>
<h3>Starting the docker machine:</h3>
<pre><code><span>crazyeights@es-base:~/Desktop/model-3$ sudo docker-compose up
</span></code></pre>
<h4>What is the name of the malicious file that has executed?</h4>
<ul>
<li>Go the localhost:5601</li>
<img src="images/m31.png" style="width: 80%">
<li>Open the sidebar and click Dashboards</li>
<li>Select the dashboard VT Hunting</li>
</ul>
<p>Malicious file is: <code>FAX_RECEIPT_SO_151-154.exe</code></p>
<ul>
<li>it is the only file in the list of malicious exes that is not a built windows utility</li>
<li>(C:\Users\lab-admin\FAX_RECEIPT_SO_151-154.exe)</li>
<li>(aka GENERALOZD.exe)</li>
<img src="images/m33.png" style="width: 80%">
</ul>
<h4>What strain of malware does it appear to be?</h4>
<ul>
<li>Select the hash from the table</li>
<li>Open virus total, and search by hash:</li>
</ul>
<pre><code><span>6F9CE67A343B9F8BED90957132BE043C
</span></code></pre>
<ul>
<li>Trojan - Agent Tesla</li>
<img src="images/m34.png" style="width: 80%">
</ul>
<h4>What does this malware typically do?</h4>
<ul>
<li>
<p>.NET based keylogger and RAT (Remote Access Trojan) readily available to actors. Logs keystrokes and the host's clipboard and beacons this information back to the command and control</p>
</li>
<li>
<p>Trojan: malware disguised a legitmate software</p>
</li>
<li>
<p>Virus Total reports smtp traffic - sending info to adversaries via smtp.</p>
</li>
<li>
<p>Snippet of behavior, shows it opening files that might contain personal information (ie. cookies, passwords, ..)</p>
<img src="images/m37.png" style="width: 80%">
</li>
</ul>
<h4>When was this malware run and by which user on what computer? (Hint: Try pinning a Dashboard filter and viewing it in Discover)</h4>
<ul>
<li>Discover:</li>
<img src="images/m35.png" style="width: 80%">
<li>
<p>Saved my filter, went to discover and applied it again.</p>
</li>
<li>
<p>User: cb3f4b32-wsw10\lab-admin</p>
</li>
<li>
<p>Time: 2020-07-16 16:28:49.511</p>
</li>
</ul>
<pre><code><span>Process Create:
RuleName: -
UtcTime: 2020-07-16 16:28:49.511
ProcessGuid: {b0701843-8041-5f10-5701-000000000500}
ProcessId: 380
Image: C:\Users\lab-admin\FAX_RECEIPT_SO_151-154.exe
FileVersion: 1.1.1.1
Description: Lm5#_9Pqn{b0701843-8041-5f10-5701-000000000500}SQ4z$&amp;w
Product: Lm5#_9Pqn{b0701843-8041-5f10-5701-000000000500}SQ4z$&amp;w
Company: q)3B4aK#b%9YA
OriginalFileName: GENERALOZD.exe
CommandLine: &quot;C:\Users\lab-admin\FAX_RECEIPT_SO_151-154.exe&quot;
CurrentDirectory: C:\Users\lab-admin\
User: cb3f4b32-wsw10\lab-admin
LogonGuid: {b0701843-803e-5f10-4c57-110000000000}
</span></code></pre>
<p>Command used is:</p>
<pre><code><span>&quot;powershell.exe&quot; -noninteractive -encodedcommand WwBDAG8AbgBzAG8AbABlAF0AOgA6AEkAbgBwAHUAdABFAG4AYwBvAGQAaQBuAGcAIAA9ACAATgBlAHcALQBPAGIAagBlAGMAdAAgAFQAZQB4AHQALgBVAFQARgA4AEUAbgBjAG8AZABpAG4AZwAgACQAZgBhAGwAcwBlADsAIABDADoAXABVAHMAZQByAHMAXABsAGEAYgAtAGEAZABtAGkAbgBcAEYAQQBYAF8AUgBFAEMARQBJAFAAVABfAFMATwBfADEANQAxAC0AMQA1ADQALgBlAHgAZQA=
</span></code></pre>
<p>which decodes to:</p>
<pre><code><span>[.C.o.n.s.o.l.e.].:.:.I.n.p.u.t.E.n.c.o.d.i.n.g. .=. .N.e.w.-.O.b.j.e.c.t. .T.e.x.t...U.T.F.8.E.n.c.o.d.i.n.g. .$.f.a.l.s.e.;. .C.:.\.U.s.e.r.s.\.l.a.b.-.a.d.m.i.n.\.F.A.X._.R.E.C.E.I.P.T._.S.O._.1.5.1.-.1.5.4...e.x.e.
</span></code></pre>
<h4>What process wrote the malicious file to disk and when?</h4>
<ul>
<li>
<p>Filter winlog.event_data.TargetFilename</p>
</li>
<li>
<p>Filter event.action to be: Process Create (rule: ProcessCreate)</p>
</li>
<li>
<p>Time: 2020-07-16 16:28:45.288</p>
</li>
<li>
<p>Process: Powershell</p>
</li>
</ul>
<pre><code><span>File created:
RuleName: EXE
UtcTime: 2020-07-16 16:28:45.288
ProcessGuid: {b0701843-803c-5f10-4901-000000000500}
ProcessId: 1272
Image: C:\windows\System32\WindowsPowerShell\v1.0\powershell.exe
TargetFilename: C:\Users\lab-admin\FAX_RECEIPT_SO_151-154.exe
CreationUtcTime: 2020-07-16 16:28:45.288
</span></code></pre>
<p>FIN.</p>
</div>
</section>
<footer class="footer">
    <div class="container">
        <div class="columns">
        </div>
    </div>
</footer>
</body>
</html>