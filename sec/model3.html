<!DOCTYPE html>
<html><head><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mermaid/8.4.6/mermaid.min.js"></script><script type="text/x-mathjax-config">MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}});</script><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/latest.js?config=TeX-MML-AM_CHTML"></script><link rel="stylesheet" href="static/default.min.css"><script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.4.0/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script><link rel="stylesheet" href="static/light.css"/></head><body>
<a href="../boxesfolder.html" style="padding: 5px; color: black; position: absolute;">BACK</a><br>
<img src="images/crazyeights.png" style="display: block; padding: 5px 0px; width: 50%; margin: auto; margin-top: 5px;">
<h2>Find the bad - model3</h2>
<h6>Oct, 2020</h6>
<ul>
<li>log analysis/blue team focused lab</li>
<li>introductory lab for doing log analysis with Kibana</li>
</ul>
<h5>Link:</h5>
<p><a href="https://github.com/findthebad/model-3">https://github.com/findthebad/model-3</a></p>
<h3>Prereqs:</h3>
<pre><code>sudo apt-get install docker
sudo apt-get install docker-compose
</code></pre>
<h3>Setup:</h3>
<pre><code>git clone https://github.com/findthebad/model-3
cd model-3/
docker-compose up
</code></pre>
<ul>
<li>Go to localhost:5601 to access the Kibana instance.</li>
</ul>
<h4>Lab questions:</h4>
<ul>
<li>What is the name of the malicious file that has executed?</li>
<li>What strain of malware does it appear to be?</li>
<li>What does this malware typically do?</li>
<li>When was this malware run and by which user on what computer? (Hint: Try pinning a Dashboard filter and viewing it in Discover)</li>
<li>What process wrote the malicious file to disk and when?</li>
</ul>
<h3>Starting the docker machine:</h3>
<pre><code>crazyeights@es-base:~/Desktop/model-3$ sudo docker-compose up
</code></pre>
<h4>What is the name of the malicious file that has executed?</h4>
<ul>
<li>Go the localhost:5601</li>
<img src="images/m31.png" style="width: 80%">
<li>Open the sidebar and click Dashboards</li>
<li>Select the dashboard VT Hunting</li>
</ul>
<p>Malicious file is: <code>FAX_RECEIPT_SO_151-154.exe</code></p>
<ul>
<li>it is the only file in the list of malicious exes that is not a built windows utility</li>
<li>(C:\Users\lab-admin\FAX_RECEIPT_SO_151-154.exe)</li>
<li>(aka GENERALOZD.exe)</li>
<img src="images/m33.png" style="width: 80%">
</ul>
<h4>What strain of malware does it appear to be?</h4>
<ul>
<li>Select the hash from the table</li>
<li>Open virus total, and search by hash:</li>
</ul>
<pre><code>6F9CE67A343B9F8BED90957132BE043C
</code></pre>
<ul>
<li>Trojan - Agent Tesla</li>
<img src="images/m34.png" style="width: 80%">
</ul>
<h4>What does this malware typically do?</h4>
<ul>
<li>
<p>.NET based keylogger and RAT (Remote Access Trojan) readily available to actors. Logs keystrokes and the host's clipboard and beacons this information back to the command and control</p>
</li>
<li>
<p>Trojan: malware disguised a legitmate software</p>
</li>
<li>
<p>Virus Total reports smtp traffic - sending info to adversaries via smtp.</p>
</li>
<li>
<p>Snippet of behavior, shows it opening files that might contain personal information (ie. cookies, passwords, ..)</p>
<img src="images/m37.png" style="width: 80%">
</li>
</ul>
<h4>When was this malware run and by which user on what computer? (Hint: Try pinning a Dashboard filter and viewing it in Discover)</h4>
<ul>
<li>Discover:</li>
<img src="images/m35.png" style="width: 80%">
<li>
<p>Saved my filter, went to discover and applied it again.</p>
</li>
<li>
<p>User: cb3f4b32-wsw10\lab-admin</p>
</li>
<li>
<p>Time: 2020-07-16 16:28:49.511</p>
</li>
</ul>
<pre><code>Process Create:
RuleName: -
UtcTime: 2020-07-16 16:28:49.511
ProcessGuid: {b0701843-8041-5f10-5701-000000000500}
ProcessId: 380
Image: C:\Users\lab-admin\FAX_RECEIPT_SO_151-154.exe
FileVersion: 1.1.1.1
Description: Lm5#_9Pqn{b0701843-8041-5f10-5701-000000000500}SQ4z$&amp;w
Product: Lm5#_9Pqn{b0701843-8041-5f10-5701-000000000500}SQ4z$&amp;w
Company: q)3B4aK#b%9YA
OriginalFileName: GENERALOZD.exe
CommandLine: &quot;C:\Users\lab-admin\FAX_RECEIPT_SO_151-154.exe&quot;
CurrentDirectory: C:\Users\lab-admin\
User: cb3f4b32-wsw10\lab-admin
LogonGuid: {b0701843-803e-5f10-4c57-110000000000}
</code></pre>
<p>Command used is:</p>
<pre><code>&quot;powershell.exe&quot; -noninteractive -encodedcommand WwBDAG8AbgBzAG8AbABlAF0AOgA6AEkAbgBwAHUAdABFAG4AYwBvAGQAaQBuAGcAIAA9ACAATgBlAHcALQBPAGIAagBlAGMAdAAgAFQAZQB4AHQALgBVAFQARgA4AEUAbgBjAG8AZABpAG4AZwAgACQAZgBhAGwAcwBlADsAIABDADoAXABVAHMAZQByAHMAXABsAGEAYgAtAGEAZABtAGkAbgBcAEYAQQBYAF8AUgBFAEMARQBJAFAAVABfAFMATwBfADEANQAxAC0AMQA1ADQALgBlAHgAZQA=
</code></pre>
<p>which decodes to:</p>
<pre><code>[.C.o.n.s.o.l.e.].:.:.I.n.p.u.t.E.n.c.o.d.i.n.g. .=. .N.e.w.-.O.b.j.e.c.t. .T.e.x.t...U.T.F.8.E.n.c.o.d.i.n.g. .$.f.a.l.s.e.;. .C.:.\.U.s.e.r.s.\.l.a.b.-.a.d.m.i.n.\.F.A.X._.R.E.C.E.I.P.T._.S.O._.1.5.1.-.1.5.4...e.x.e.
</code></pre>
<h4>What process wrote the malicious file to disk and when?</h4>
<ul>
<li>
<p>Filter winlog.event_data.TargetFilename</p>
</li>
<li>
<p>Filter event.action to be: Process Create (rule: ProcessCreate)</p>
</li>
<li>
<p>Time: 2020-07-16 16:28:45.288</p>
</li>
<li>
<p>Process: Powershell</p>
</li>
</ul>
<pre><code>File created:
RuleName: EXE
UtcTime: 2020-07-16 16:28:45.288
ProcessGuid: {b0701843-803c-5f10-4901-000000000500}
ProcessId: 1272
Image: C:\windows\System32\WindowsPowerShell\v1.0\powershell.exe
TargetFilename: C:\Users\lab-admin\FAX_RECEIPT_SO_151-154.exe
CreationUtcTime: 2020-07-16 16:28:45.288
</code></pre>
<p>FIN.</p>
</body></html>
